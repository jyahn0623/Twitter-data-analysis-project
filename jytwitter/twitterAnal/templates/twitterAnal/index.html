{% load static %}
<html>
<head>
<!--Morris, jquery, bootstrap cdn import-->
 <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css">
 <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
 <script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
 <script src="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>
 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <title>Twitter Analysis</title>
</head>
<body>
<button class="btn btn-danger col-sm-12" onclick="getData();">Click</button>
    <div class="col-sm-6">
        <h2>총 언급량</h2>
        <div id="data1"></div>
    </div>
    <hr>
    <div class="col-sm-6">
        <h2>종류별 데이터</h2>
        <div id="data2"></div>
    </div>
    <hr>
    <div class="col-sm-6">
        <h2>시간대별 관심도(메뉴별)</h2>
        <div id="data3"></div>
    </div>
    <hr>
    <div class="col-sm-6">
        <h2>요일별 관심도(메뉴별)</h2>
        <div id="data4"></div>
    </div>
    <hr>
    <div class="col-sm-6">
        <h2>시간대별 관심도(종류별)</h2>
        <div id="data3"></div>
    </div>
    <hr>
    <div class="col-sm-6">
        <h2>요일별 관심도(종류별)</h2>
        <div id="data4"></div>
    </div>

<div id="data"></div>

<script src="http://code.jquery.com/jquery-2.0.0.js"></script>  
<script>
$(document).ready(function(){
    /*
    Morris.Line({
        element: 'data1',
        data: 
        xkey: 'y',
        ykeys: ['한식', '중식', '일식'],
        labels: ['한식', '중식', '일식'],
    });
    */
})

data_time = {}
data_day = {}
function getData(){
    $.ajax({
        url : "{% url 'JY:getData' %}",
        type : "GET",
        data : {
            'csrfmiddlewaretoken': '{{ csrf_token }}',
        },
        success: function(res)
        {
            data_time = res.data_times;
            data_day = res.data_days;
            a = Object.keys(data_time.data);
            $("#data").html(JSON.stringify(res));
            DrawGraph(res);
        },
        error : function(res){
            alert("Error");
        }
    });
}

function DrawGraph(res)
{
    var config = {
        xkey: 'y',
        xLabelAngle: 45,
    };
    var data;
    //총 언급량
    var value = []
    for ( var item in res.data_types){
        var tmp_list = res.data_types[item];
        value.push(tmp_list[0]+tmp_list[1]+tmp_list[2]);
    }
    data = [
        { y: '2019-04-01', '언급량' : value[0]},
        { y: '2019-04-02', '언급량' : value[1]},
        { y: '2019-04-03', '언급량' : value[2]},
        { y: '2019-04-04', '언급량' : value[3]},
        { y: '2019-04-05', '언급량' : value[4]},
        { y: '2019-04-06', '언급량' : value[5]},
        { y: '2019-04-07', '언급량' : value[6]}
    ];
    config.data = data;
    config.ykeys = ['언급량'];
    config.labels = ['총 언급량']
    config.element = 'data1';
    config.xLabels = "day";
    Morris.Line(config);

    //종류별 데이터
    data = [
        { y: '2019-04-01', '한식' : res.data_types['4-1'][1], '중식' : res.data_types['4-1'][0], '일식': res.data_types['4-1'][2]},
        { y: '2019-04-02', '한식' : res.data_types['4-2'][1], '중식' : res.data_types['4-2'][0], '일식': res.data_types['4-2'][2]},
        { y: '2019-04-03', '한식' : res.data_types['4-3'][1], '중식' : res.data_types['4-3'][0], '일식': res.data_types['4-3'][2]},
        { y: '2019-04-04', '한식' : res.data_types['4-4'][1], '중식' : res.data_types['4-4'][0], '일식': res.data_types['4-4'][2]},
        { y: '2019-04-05', '한식' : res.data_types['4-5'][1], '중식' : res.data_types['4-5'][0], '일식': res.data_types['4-5'][2]},
        { y: '2019-04-06', '한식' : res.data_types['4-6'][1], '중식' : res.data_types['4-6'][0], '일식': res.data_types['4-6'][2]},
        { y: '2019-04-07', '한식' : res.data_types['4-7'][1], '중식' : res.data_types['4-7'][0], '일식': res.data_types['4-7'][2]}
    ];
    config.data = data;
    config.ykeys = ['한식', '중식', '일식'];
    config.labels =['한', '중', '일'];
    config.element = 'data2';
    Morris.Line(config);

    //시간대별
    col = []
    d_list = []
    var num = 0;
    col = Object.keys(data_time['data'][0]);
    for ( var a in data_time['data']){
        data_time['data'][a]['hours'] = num++;
        data = data_time['data'][a];
        d_list.push(data);
    }
    // labels, keys setting
    config.labels = col;
    config.ykeys = col;
    config.xkey = "hours";
    config.xLabels = "hour";
    config.parseTime = false;
    config.element = 'data3';
    config.data = d_list;
    Morris.Line(config);

    //요일별
    d_list = []
    day = ['월', '화', '수', '목', '금', '토', '일'];
    num = 0
    for ( var a in data_day['data']){
        data_day['data'][a]['day'] = day[num++];
        data = data_day['data'][a];
        d_list.push(data);
    }
    config.xkey = "day";
    config.xLabels = "day";
    config.data = d_list;
    config.element = 'data4';
    Morris.Line(config);

}
</script>
</body>
</html>
