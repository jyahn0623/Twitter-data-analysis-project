{% load static %}
<html>
<head>
<!--Morris, jquery, bootstrap cdn import-->
 <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.css">
 <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
 <script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
 <script src="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>
 <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <title>Twitter Analysis</title>
</head>
<body>
    <div class="col-sm-12">
        <i style="font-size : 50px">Twitter Data Analysis</i>
        <div style="font-size : 30px"><span id="time">0</span></div>
    </div>
    <div id="datas" class="ml-3 mt-3"></div>
    <div id="rank"></div>
    <div>10초 간격으로 갱신</div>
    <button class="btn btn-info" onclick="getData();">수동 갱신</button>

<script src="http://code.jquery.com/jquery-2.0.0.js"></script>  
<script>
$(document).ready(function(){
    getData();
    timeAlarm();
})

// 각각 데이터를 담아 둘 변수
var menu_list = [];
var datas = {};
var datas1 = {};
var colors = ['#0b62a4', '#DCE775', '#F48FBE', '#EC407E', '#7B1FA2', '#5E35BE','#BBDEFE', '#64B5FE', '#5C6BC0', '#303F9F', '#1565CE', '#82B1FE', '#80DEEE', '#00E5FE','#81C78E', '#00796B', '#5F6460'];
// 10초마다 갱신
setInterval(getData, 10000);
setInterval(timeAlarm, 1000);
function timeAlarm(){
    $("span#time").html(new Date(Date.now()));
}

// ajax로 데이터를 받아와 처리
function getData(){
    $.ajax({
        url : "{% url 'JY:getData' %}",
        type : "GET",
        data : {
            'csrfmiddlewaretoken': '{{ csrf_token }}',
        },
        success: function(res)
        {
            datas = res.datas;
            $("#rank").html(res.rank + " ");
            Data_to(datas);
        }
    })
}

// 받아온 데이터 가공
function Data_to(a)
{
    menu_list = Object.keys(a.menu);
    datas1 = a.menu;
    datas1['y'] = "Twitter Datas Analysis by AJY";
    showGraph();
}

// 가공한 데이터 그리기
function showGraph(){
    $("#datas").empty();
    Morris.Bar({
        element: 'datas',
        data: [
            datas1,
        ],
        barColors : colors,
        xkey: menu_list,
        xlabels : "y",
        ykeys: menu_list,
        labels: menu_list,
    });
}
</script>
</body>
</html>